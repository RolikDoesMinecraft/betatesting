<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TSI Locator BETA</title>
<style>
  body { margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background:#f4f6f8; color:#333; display:flex; flex-direction:column; min-height:100vh;}
  .hero { background:#2f3e46; color:#fff; padding:20px; text-align:center; }
  .hero h1 { margin:0; font-size:2rem; }
  .content { flex:1; max-width:600px; margin:20px auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
  label { display:block; margin-top:15px; font-weight:500; }
  input[type=text] { width:100%; padding:10px; border-radius:4px; border:1px solid #ccc; margin-top:5px; font-size:1rem; }
  #status { margin:15px 0; font-weight:600; font-size:1.1rem; }
  .status-green { color:green; }
  .status-red { color:red; }
  .status-yellow { color:orange; }
  .metrics { display:flex; flex-wrap:wrap; gap:15px; margin:20px 0; }
  .metric { background:#edf2f7; flex:1; min-width:150px; padding:20px; border-radius:4px; text-align:center; }
  .metric .label { font-size:0.9rem; color:#666; }
  .metric .value { font-size:1.8rem; font-weight:600; margin-top:5px; }
  .footer { text-align:center; padding:10px; background:#2f3e46; color:#fff; font-size:0.9rem; }
</style>
</head>
<body>

<div class="hero">
  <h1>TSI Locator BETA</h1>
</div>

<div class="content">
  <label for="toteInput">Scan or Enter Tote ID</label>
  <input id="toteInput" type="text" placeholder="Scan tote here" autofocus />

  <div id="status" class="status-yellow">Loading totes…</div>

  <div class="metrics">
    <div class="metric"><div class="label">Total Totes</div><div id="totalTotes" class="value">–</div></div>
    <div class="metric"><div class="label">Totes Left</div><div id="totesLeft" class="value">–</div></div>
    <div class="metric"><div class="label">Totes Found</div><div id="totesFound" class="value">0</div></div>
  </div>
</div>

<div class="footer">
  Made by Rozimnic — TSI Locator BETA
</div>

<script>
  // Set your sound file here
  const foundSoundUrl = "https://www.soundjay.com/buttons/sounds/button-3.mp3";

  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vREoeSXV0fo1U5IXL63I0t4leYsoFRlezJTRt-rC4W9VZOA0wQi_53LqYfm4rpYVMQKghjsoQ9Mj41M/pub?output=csv";

  let toteList = [];
  let foundSet = new Set();
  let lastScanTime = 0;

  function csvToArray(text) {
    return text.trim().split("\n").map(r => r.split(","));
  }

  async function loadTotes() {
    setStatus("Fetching tote list…", "yellow");
    try {
      const res = await fetch(sheetUrl);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const text = await res.text();
      const rows = csvToArray(text);

      toteList = rows.slice(1).map(r => String(r[0]).trim().toLowerCase()).filter(id => id);

      document.getElementById("totalTotes").textContent = toteList.length;
      document.getElementById("totesLeft").textContent = toteList.length;
      document.getElementById("totesFound").textContent = 0;

      setStatus("Ready to scan.", "yellow");
    } catch (e) {
      setStatus(`Error: ${e.message}`, "red");
    }
  }

  function setStatus(msg, type) {
    const statusEl = document.getElementById("status");
    statusEl.textContent = msg;
    statusEl.className = "";
    statusEl.classList.add(`status-${type}`);
  }

  function playSound(url) {
    if (url) {
      new Audio(url).play().catch(() => console.warn("Sound play failed"));
    }
  }

  function processTote(id) {
    const now = Date.now();
    if (now - lastScanTime < 3000) {
      return; // Cooldown active
    }
    lastScanTime = now;

    const idLower = id.trim().toLowerCase();
    if (!idLower) {
      setStatus("Please scan a tote ID.", "yellow");
      return;
    }

    if (foundSet.has(idLower)) {
      setStatus(`Tote "${id}" already found.`, "yellow");
      return;
    }

    if (toteList.includes(idLower)) {
      foundSet.add(idLower);
      let foundCount = foundSet.size;
      document.getElementById("totesFound").textContent = foundCount;
      document.getElementById("totesLeft").textContent = toteList.length - foundCount;
      setStatus(`Tote "${id}" found!`, "green");
      playSound(foundSoundUrl);
    } else {
      setStatus(`Tote "${id}" not in list.`, "red");
    }
  }

  function autoScan() {
    const inputEl = document.getElementById("toteInput");
    const value = inputEl.value;
    if (value.trim()) {
      processTote(value);
      inputEl.value = ""; // Clear after scan
    }
  }

  window.addEventListener("load", () => {
    loadTotes();
    setInterval(autoScan, 700); // Scan every 700ms
  });
</script>

</body>
</html>
